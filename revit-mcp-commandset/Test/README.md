# Test 测试验证层

## 概述

Test 目录包含各种验证命令，用于测试 MCP 功能模块的正确性。这些命令直接在 Revit 中执行，无需通过 MCP 服务端。

## 验证命令列表

### ValidateCopyCommand

**用途**：验证 Copy 操作功能

**测试内容**：
- 单个元素复制
- 批量元素复制
- 不同类型元素复制（族实例、系统族）
- 复制向量验证

**使用方法**：
1. 在 Revit 中选择要复制的元素
2. 执行 ValidateCopyCommand
3. 输入复制向量（X, Y, Z）
4. 验证复制结果

### ValidateDoorWindowFlipCommand

**用途**：验证门窗翻转功能

**测试内容**：
- Hand 方向翻转（左右）
- Facing 方向翻转（前后）
- 批量翻转
- 翻转状态记录

**使用方法**：
1. 选择门或窗元素
2. 执行命令选择翻转类型
3. 验证翻转效果

### ValidateParameterHelper

**用途**：验证参数自动单位转换

**测试内容**：
- 长度单位转换（mm ↔ ft）
- 角度单位转换（° ↔ rad）
- 面积、体积单位转换
- 参数类型自动识别

**验证点**：
```
输入：1000mm
预期：3.28084ft

输入：90°
预期：1.5708rad
```

### ValidateElementFilter

**用途**：验证元素过滤功能

**测试场景**：
- 类别过滤
- 类型过滤
- 名称关键字过滤
- 空间范围过滤
- 可见性过滤
- 节点化字段返回

## 测试执行流程

### 单元测试流程

1. **准备测试模型**
   - 创建包含各类元素的测试项目
   - 确保有门、窗、墙、楼板等基础元素

2. **执行验证命令**
   ```
   Revit → 外部工具 → RevitMCPCommandSet → Test → Validate*
   ```

3. **验证结果**
   - 检查操作是否成功
   - 验证返回数据格式
   - 确认单位转换正确性

### 集成测试流程

1. **启动 MCP 服务端**
2. **连接 Revit 客户端**
3. **通过 API 调用测试**
4. **验证端到端功能**

## 测试数据准备

### 标准测试项目

建议准备包含以下元素的测试项目：

- **族实例**：门、窗、家具（至少各 5 个）
- **系统族**：墙体、楼板、屋顶（至少各 3 个）
- **不同标高**：至少 2 个标高
- **不同视图**：平面、立面、3D 视图

### 测试参数配置

```json
{
  "testConfig": {
    "maxElements": 10,
    "timeout": 5000,
    "validateResults": true
  }
}
```

## 错误场景测试

### 必测错误场景

1. **空选择**：未选择任何元素
2. **类型不匹配**：对墙体执行门窗翻转
3. **参数缺失**：缺少必需参数
4. **超时处理**：大批量操作超时
5. **权限问题**：只读视图中的修改操作

### 错误恢复验证

- 事务回滚是否正确
- 错误信息是否清晰
- 日志记录是否完整

## 性能测试

### 基准测试

| 操作 | 元素数量 | 预期时间 |
|------|---------|----------|
| Filter | 100 | <1s |
| Copy | 50 | <2s |
| Transform | 30 | <1s |
| Modify | 100 | <3s |

### 压力测试

- 最大元素数量：1000
- 并发操作：3 个命令同时执行
- 内存监控：不超过 500MB 增量

## 测试报告

### 报告模板

```markdown
## 测试报告 - [日期]

### 测试环境
- Revit 版本：
- .NET 版本：
- 项目规模：

### 测试结果
- 通过：X 个
- 失败：Y 个
- 跳过：Z 个

### 问题列表
1. [问题描述]
   - 复现步骤
   - 预期结果
   - 实际结果
```

## 相关文档

- **测试计划**：doc/MCP_TEST_PLAN.md
- **功能文档**：Features/*/README.md
- **API 文档**：RevitMCPSDK 文档