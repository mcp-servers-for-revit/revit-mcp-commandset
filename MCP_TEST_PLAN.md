# MCP v3.0 命令体系测试计划

## 测试背景

本测试计划用于验证 Revit MCP v3.0 新命令体系的基本功能。v3.0 架构将原有的单一 `operate_element` 命令拆分为4个专门化命令，旨在提升 AI Token 使用效率和操作精确性。

### 新命令体系
- **operate_element_visual**: 纯视觉效果操作
- **operate_element_visibility**: 可见性控制操作
- **operate_element_transform**: 几何变换操作
- **operate_element_modify**: 参数修改与删除操作

## 测试环境假设

- Revit 项目已打开且 MCP 插件已加载
- 项目中已存在基础构件：
  - **一扇门** (Door)
  - **一堵墙** (Wall)
  - **一块楼板** (Floor)

## 测试场景

### 场景1：查找项目中的门
**测试目的**: 验证元素查询功能是否正常工作
**操作描述**: 查找并获取项目中所有门的信息
**期望结果**: 返回门的详细信息，包括ID、位置、类型等
**涉及命令**: ai_element_filter

---

### 场景2：高亮显示墙体
**测试目的**: 验证视觉标记功能
**操作描述**: 将墙体高亮显示为红色
**期望结果**: 墙体在 Revit 视图中显示为红色高亮状态
**涉及命令**: operate_element_visual

---

### 场景3：隐藏楼板
**测试目的**: 验证可见性控制功能
**操作描述**: 在当前视图中隐藏楼板
**期望结果**: 楼板在当前视图中不可见
**涉及命令**: operate_element_visibility

---

### 场景4：翻转门
**测试目的**: 验证几何变换功能中的翻转操作
**操作描述**: 将门上下方向翻转一下
**期望结果**: 门的朝向由向下改成向上
**涉及命令**: operate_element_transform

---

### 场景5：修改墙体的注释参数
**测试目的**: 验证参数修改功能
**操作描述**: 修改墙体的"Comments"参数为"测试墙体"
**期望结果**: 墙体的注释参数值更新为指定内容
**涉及命令**: operate_element_modify

---

### 场景6：设置楼板半透明
**测试目的**: 验证透明度调整功能
**操作描述**: 将楼板设置为50%透明度
**期望结果**: 楼板显示为半透明状态，可以看到底下的内容
**涉及命令**: operate_element_visual

---

### 场景7：隔离显示门和墙
**测试目的**: 验证隔离显示功能
**操作描述**: 在当前视图中仅显示门和墙，隐藏其他所有元素
**期望结果**: 视图中仅显示门和墙，其他元素被隐藏
**涉及命令**: operate_element_visibility

---

### 场景8：移动门的位置
**测试目的**: 验证移动操作（P1阶段 directTransform 策略）
**操作描述**: 将门沿X轴方向移动1000mm
**期望结果**: 门的位置沿X轴移动1米距离
**涉及命令**: operate_element_transform

---

### 场景9：查询所有墙体类型的元素
**测试目的**: 验证类别过滤功能
**操作描述**: 查找项目中所有墙体类别的元素
**期望结果**: 返回所有墙体元素的详细列表
**涉及命令**: ai_element_filter

---

### 场景10：恢复视图到正常状态
**测试目的**: 验证重置功能
**操作描述**: 清除所有隐藏、隔离和视觉效果，恢复视图正常状态
**期望结果**: 所有元素恢复正常显示，无特殊视觉效果
**涉及命令**: operate_element_visibility, operate_element_visual

## 成功判定标准

### 基本要求
- [ ] 所有命令执行无编译错误
- [ ] 所有命令能成功发送到 Revit 端
- [ ] 返回结果格式符合 AIResult<ElementOperationResponse> 规范

### 功能要求
- [ ] 查询操作返回正确的元素信息
- [ ] 视觉操作在 Revit 界面中正确显示
- [ ] 可见性操作正确控制元素显示/隐藏
- [ ] 几何变换操作正确改变元素位置/角度
- [ ] 参数修改操作成功更新元素属性

### 性能要求
- [ ] 单个操作响应时间 < 3秒
- [ ] 复杂操作（如变换）响应时间 < 10秒
- [ ] 无内存泄漏或资源占用异常

## 测试执行说明

1. **按顺序执行**: 建议按场景编号顺序执行，避免状态冲突
2. **状态重置**: 如需重复测试，先执行场景10恢复正常状态
3. **错误记录**: 记录任何失败的场景和错误信息
4. **AI选择**: 让 AI 根据场景描述自主选择合适的命令、参数和操作策略

## 预期收益

通过本测试计划的执行，验证：
- v3.0 四命令架构的可用性
- Token 使用效率的提升
- 操作精确性的改善
- 错误处理机制的有效性

---

**注意**: 本测试计划专注于基本功能验证，不涉及复杂的边界条件测试。如发现问题，应及时记录并反馈给开发团队。